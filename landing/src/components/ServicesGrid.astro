---
import {Icon} from 'astro-icon/components'

const developmentPackages = [
    {
        name: "Startup Core",
        price: 4999,
        paymentStructure: [
            {amount: 2500, phase: "To start"},
            {amount: 1250, phase: "Midpoint"},
            {amount: 1249, phase: "Completion"}
        ],
        paymentButton: 'https://buy.appsbyluke.com/overlay/8949f95f-e9b4-4d34-b216-6e007fc07ff3',
        timeline: "2-3 weeks",
        description: "Launch your MVP with one core feature to validate your idea",
        idealFor: [
            "Pre-seed startups",
            "First-time founders",
            "Idea validation phase"
        ],
        techStack: {
            frontend: ["Vue.js/Nuxt", "Tailwind CSS"],
            backend: ["NestJS", "TypeScript"],
            database: ["Relational Database"]
        },
        coreFeatures: [
            {
                icon: "tabler:users",
                text: "Authentication System",
                detail: "Login, registration, password reset"
            },
            {
                icon: "tabler:components",
                text: "One Core Feature",
                detail: "Your main product functionality"
            },
            {
                icon: "tabler:dashboard",
                text: "Basic Admin Panel",
                detail: "Manage users and core feature"
            },
            {
                icon: "tabler:api",
                text: "Basic API",
                detail: "Essential endpoints for core feature"
            }
        ],
        promoted: false
    },
    {
        name: "Startup Plus",
        price: 9999,
        paymentStructure: [
            {amount: 5000, phase: "To start"},
            {amount: 2500, phase: "Midpoint"},
            {amount: 2499, phase: "Completion"}
        ],
        paymentButton: 'https://buy.appsbyluke.com/overlay/b374e799-d709-4916-9cb0-99400692db1b',
        timeline: "4-6 weeks",
        description: "Enhanced MVP with additional features and better user experience",
        idealFor: [
            "Funded startups",
            "Products with initial traction",
            "B2B SaaS applications"
        ],
        techStack: {
            frontend: ["Vue.js/Nuxt", "Tailwind CSS"],
            backend: ["NestJS", "TypeScript"],
            database: ["Relational Database", "Cache Layer"]
        },
        coreFeatures: [
            {
                icon: "tabler:users",
                text: "Team Management",
                detail: "Multi-user organizations"
            },
            {
                icon: "tabler:components",
                text: "Three Core Features",
                detail: "Extended product functionality"
            },
            {
                icon: "tabler:brand-stripe",
                text: "Payment Integration",
                detail: "Stripe subscription setup"
            },
            {
                icon: "tabler:api",
                text: "Extended API",
                detail: "Full REST API with documentation"
            }
        ],
        promoted: true
    },
    {
        name: "Startup Pro",
        price: 19999,
        paymentStructure: [
            {amount: 10000, phase: "To start"},
            {amount: 5000, phase: "Midpoint"},
            {amount: 4999, phase: "Completion"}
        ],
        paymentButton: 'https://buy.appsbyluke.com/overlay/f6ff4cb8-3537-4144-b7b5-fb22867c8c22',
        timeline: "8-10 weeks",
        description: "Full-featured application ready for scaling",
        idealFor: [
            "Funded startups",
            "High-growth products",
            "Complex B2B solutions"
        ],
        techStack: {
            frontend: ["Vue.js/Nuxt", "Tailwind CSS"],
            backend: ["NestJS", "TypeScript"],
            database: ["Relational Database", "Cache Layer", "Search Engine"]
        },
        coreFeatures: [
            {
                icon: "tabler:users",
                text: "Advanced User System",
                detail: "SSO, roles, permissions"
            },
            {
                icon: "tabler:components",
                text: "Full Feature Set",
                detail: "Complete product functionality"
            },
            {
                icon: "tabler:report-analytics",
                text: "Analytics & Reporting",
                detail: "Custom dashboards and exports"
            },
            {
                icon: "tabler:webhook",
                text: "Integration System",
                detail: "Webhooks and external APIs"
            }
        ],
        promoted: false
    }
];
---

<div class="mb-16">
    <div class="max-w-screen-xl mx-auto px-4">
        <div class="flex flex-col space-y-12 md:space-y-16">
            {developmentPackages.map((devPackage, index) => (
                    <div class="flex flex-col lg:flex-row items-center gap-6 lg:gap-12">
                        <div class="w-full lg:w-1/2">
                            <div class={`
                            bg-white border-4 border-black p-6 
                            shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] 
                            transform ${devPackage.promoted ? 'rotate-1' : '-rotate-1'} 
                            relative
                        `}>
                                {devPackage.promoted && (
                                        <div class="absolute -top-4 -right-4 bg-green-400 text-black font-bold py-1 px-3 border-4 border-black transform rotate-3">
                                            Most Popular
                                        </div>
                                )}

                                <h3 class="text-2xl font-bold mb-2">{devPackage.name}</h3>
                                <p class="text-gray-600 mb-4">{devPackage.description}</p>

                                <div class="text-3xl font-bold text-blue-500 mb-2">
                                    ${devPackage.price}
                                </div>

                                <div class="space-y-1 mb-6">
                                    <p class="text-sm text-gray-600">Delivery: {devPackage.timeline}</p>

                                </div>

                                <div class="bg-yellow-100 border-2 border-black p-4 mb-6 shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]">
                                    <h4 class="font-bold text-sm mb-2 bg-black text-white inline-block px-2 py-1 transform -rotate-1">
                                        Perfect For
                                    </h4>
                                    <ul class="space-y-2 mt-2">
                                        {devPackage.idealFor.map((ideal) => (
                                                <li class="flex items-start gap-2">
                                                    <Icon name="tabler:point" class="w-4 h-4 flex-shrink-0 mt-1"/>
                                                    <span>{ideal}</span>
                                                </li>
                                        ))}
                                    </ul>
                                </div>

                                <div class="bg-blue-50 border-2 border-black p-3 mt-2 mb-6">
                                    <h4 class="font-bold text-sm mb-2 bg-black text-white inline-block px-2 py-1 transform -rotate-1">
                                        Payment Schedule
                                    </h4>
                                    <div class="space-y-1 mt-2">
                                        {devPackage.paymentStructure.map((payment) => (
                                                <div class="flex justify-between items-center text-sm">
                                                    <span class="text-gray-600">{payment.phase}:</span>
                                                    <span class="font-bold">${payment.amount}</span>
                                                </div>
                                        ))}
                                    </div>
                                </div>

                                <div class="flex items-center justify-center">
                                    <div class="flex flex-col items-center w-full">
                                        <button
                                                type="button"
                                                data-fungies-button={devPackage.paymentButton}
                                                class="block w-full text-center bg-green-600 hover:bg-green-700 font-bold py-3 px-6 border-black border-4 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] transition-all duration-300 text-xl text-white">
                                            Get Started
                                        </button>
                                        <a href="https://calendar.app.google/uDz6rZrYgUxqAC2i9"
                                           class="mt-2 inline-block w-full text-center underline underline-offset-4 decoration-dashed text-sm text-gray-600 hover:text-black transition-colors duration-300">
                                            or book a quick call to learn more
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="w-full lg:w-1/2 space-y-6">
                            <div class="space-y-4">
                                <h4 class="text-xl font-bold text-sm mb-2 bg-black text-white inline-block px-2 py-1 transform -rotate-1">
                                    Core Features
                                </h4>
                                <div class="space-y-4 mt-2">
                                    {devPackage.coreFeatures.map((feature) => (
                                            <div class="flex items-start gap-4">
                                                <div class="w-10 h-10 flex-shrink-0 bg-gray-100 border-2 border-black flex items-center justify-center">
                                                    <Icon name={feature.icon} class="w-5 h-5"/>
                                                </div>
                                                <div>
                                                    <span class="font-bold block text-lg">{feature.text}</span>
                                                    <span class="text-gray-600">{feature.detail}</span>
                                                </div>
                                            </div>
                                    ))}
                                </div>
                            </div>

                            <div class="bg-blue-50 border-2 border-black p-4 shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]">
                                <h4 class="font-bold text-sm mb-2 bg-black text-white inline-block px-2 py-1 transform -rotate-1">
                                    Tech Stack
                                </h4>
                                <div class="space-y-3 mt-2">
                                    {Object.entries(devPackage.techStack).map(([category, technologies]) => (
                                            <div>
                                                <span class="text-sm text-gray-600 font-semibold">{category.charAt(0).toUpperCase() + category.slice(1)}:</span>
                                                <div class="flex flex-wrap gap-2 mt-1">
                                                    {technologies.map((tech) => (
                                                            <span class="inline-block bg-white px-2 py-1 text-xs border border-black shadow-[1px_1px_0px_0px_rgba(0,0,0,1)]">
                                                    {tech}
                                                </span>
                                                    ))}
                                                </div>
                                            </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
            ))}
        </div>
    </div>
</div>

<div class="text-sm text-gray-600 -rotate-1 text-center my-16 px-4">
    * All packages include source code, documentation, and deployment guide. Prices are in USD. Payment processed
    securely with 250+ payment methods available including credit cards, PayPal, and more.
</div>

<script is:inline>
    function initializeFungies() {
        let iframe;
        let spinner;

        function createSpinner() {
            const spinnerHtml = `
                <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-[2147483646]">
                    <div class="bg-white border-4 border-black p-6 rounded-lg shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] transform -rotate-1">
                        <div class="flex items-center gap-3">
                            <svg class="animate-spin h-8 w-8 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <span class="font-bold text-lg">Loading payment form...</span>
                        </div>
                    </div>
                </div>
            `;

            spinner = document.createElement('div');
            spinner.innerHTML = spinnerHtml;
            document.body.appendChild(spinner);
        }

        function removeSpinner() {
            if (spinner) {
                spinner.remove();
                spinner = null;
            }
        }

        function displayIframe(e) {
            e.preventDefault();
            if(iframe) return;

            createSpinner();

            const button = e.currentTarget;
            iframe = document.createElement("iframe");

            iframe.style = `
                z-index: 2147483647;
                display: block;
                background-color: transparent;
                border: 0;
                overflow-x: hidden;
                overflow-y: auto;
                visibility: visible;
                margin: 0;
                padding: 0;
                -webkit-tap-highlight-color: transparent;
                position: fixed;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
            `;

            iframe.addEventListener('load', () => {
                removeSpinner();
            });

            const src = button.dataset.fungiesButton;
            iframe.src = src;
            iframe.allow = "payment";
            document.body.appendChild(iframe);
        }

        function messageHandler(event) {
            if (event.data === "closeWindow") {
                iframe?.remove();
                iframe = null;
                removeSpinner();
            }
        }

        window.removeEventListener("message", messageHandler);
        window.addEventListener("message", messageHandler);

        document.querySelectorAll("[data-fungies-button]").forEach(button => {
            button.removeEventListener("click", displayIframe);
            button.addEventListener("click", displayIframe);
        });
    }

    initializeFungies();

    document.addEventListener('astro:page-load', initializeFungies);
</script>

